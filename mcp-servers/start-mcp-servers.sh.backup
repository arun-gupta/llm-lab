#!/bin/bash

# Start MCP Servers Script
# This script starts MCP servers for LLM Lab

set -e

MCP_DIR="$HOME/.mcp-servers"
cd "$MCP_DIR"

echo "Starting MCP Server Infrastructure..."

# Load port configuration
CONFIG_FILE="../../config/ports.json"
if [ -f "$CONFIG_FILE" ] && command -v jq &> /dev/null; then
    MCP_FILESYSTEM_PORT=$(jq -r '.development.mcp.filesystem' "$CONFIG_FILE")
else
    MCP_FILESYSTEM_PORT=3002
fi

# Start the HTTP Filesystem MCP server
echo "Starting HTTP Filesystem MCP Server on port $MCP_FILESYSTEM_PORT..."
cd http-filesystem-mcp-server
PORT=$MCP_FILESYSTEM_PORT nohup node index.js > ../http-filesystem-mcp-server.log 2>&1 &
FILESYSTEM_PID=$!
echo $FILESYSTEM_PID > ../http-filesystem-mcp-server.pid
cd ..

echo "MCP server infrastructure started!"
echo "HTTP Filesystem MCP Server: http://localhost:$MCP_FILESYSTEM_PORT"
echo ""
echo "Available Remote MCP Servers:"
echo "  • GitHub MCP Server: https://api.githubcopilot.com/mcp/"
echo "  • GitHub Repositories: https://api.githubcopilot.com/mcp/x/repos"
echo "  • GitHub Issues: https://api.githubcopilot.com/mcp/x/issues"
echo "  • GitHub Pull Requests: https://api.githubcopilot.com/mcp/x/pull_requests"
echo "  • GitHub Actions: https://api.githubcopilot.com/mcp/x/actions"
echo ""
echo "SQLite MCP Server: Docker container (managed separately)"
echo "Logs are available in $MCP_DIR/http-filesystem-mcp-server.log"
echo "PID is stored in $MCP_DIR/http-filesystem-mcp-server.pid"
